<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-cli 源码学习 | 独上青楼</title>
    <meta name="description" content="昨夜西风凋碧树，独上青楼，望尽天涯路。">
    <script src="https://hm.baidu.com/hm.js?d341a53286439929323f4c9bccd9e597"></script>
  <script src="https://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
  <script src="snow.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.a9915e81.css" as="style"><link rel="preload" href="/assets/js/app.22d2f077.js" as="script"><link rel="preload" href="/assets/js/3.8ed3c424.js" as="script"><link rel="prefetch" href="/assets/js/10.54150dcb.js"><link rel="prefetch" href="/assets/js/11.6d0471f3.js"><link rel="prefetch" href="/assets/js/12.b0bd100b.js"><link rel="prefetch" href="/assets/js/13.db668662.js"><link rel="prefetch" href="/assets/js/14.8f9a8c98.js"><link rel="prefetch" href="/assets/js/15.7e3621b8.js"><link rel="prefetch" href="/assets/js/16.5e966ec9.js"><link rel="prefetch" href="/assets/js/17.4c400c2c.js"><link rel="prefetch" href="/assets/js/2.7463680f.js"><link rel="prefetch" href="/assets/js/4.5a78423f.js"><link rel="prefetch" href="/assets/js/5.a659ff63.js"><link rel="prefetch" href="/assets/js/6.430473a8.js"><link rel="prefetch" href="/assets/js/7.1f26b8b6.js"><link rel="prefetch" href="/assets/js/8.15d1ba88.js"><link rel="prefetch" href="/assets/js/9.1b61a5c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a9915e81.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="page-main"><div class="component-nav-menu"><div class="placeholder"></div> <div class="search-wrapper"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-9912" class="el-autocomplete"><div class="el-input el-input--prefix"><!----><input type="text" autocomplete="off" valueKey="title" placeholder="请输入内容呀" fetchSuggestions="function () { [native code] }" triggerOnFocus="true" debounce="300" placement="bottom-start" popperAppendToBody="true" background-color="#eee" value="" class="el-input__inner"><span class="el-input__prefix"><i class="el-input__icon el-icon-search"></i></span><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <ul role="menubar" class="el-menu--horizontal el-menu" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        首页
      </li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:;border-bottom-color:;background-color:;">
        Blog
      </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        关于我
      </li></ul></div> <div class="page-container"><div class="component-page"><div class="page-content"><!----> <div class="content custom"><h1 id="vue-cli-源码学习"><a href="#vue-cli-源码学习" aria-hidden="true" class="header-anchor">#</a> vue-cli 源码学习</h1> <blockquote><p>工作之中，常常会收到新需求，重复的搭建相同的项目壳子会让一个程序猿抓狂，所以如果执行一段命令就能生成项目壳子，势必能让程序猿捶胸而不顿足。好的脚手架工具的结构是怎么样的，看了 <code>vue-cli</code> 源码后，有收获。</p></blockquote> <h2 id="基本思路"><a href="#基本思路" aria-hidden="true" class="header-anchor">#</a> 基本思路</h2> <p><img src="/assets/img/vueclitemplate-01.22ecf681.jpg" alt></p> <h2 id="目录结构"><a href="#目录结构" aria-hidden="true" class="header-anchor">#</a> 目录结构</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>vue<span class="token operator">-</span>cli
└───bin
<span class="token operator">|</span>   <span class="token operator">|</span>   vue
<span class="token operator">|</span>   <span class="token operator">|</span>   vue<span class="token operator">-</span>build
<span class="token operator">|</span>   <span class="token operator">|</span>   vue<span class="token operator">-</span>create
<span class="token operator">|</span>   <span class="token operator">|</span>   vue<span class="token operator">-</span>init
<span class="token operator">|</span>   <span class="token operator">|</span>   vue<span class="token operator">-</span>list
└───lib
│   <span class="token operator">|</span>   ask<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   check<span class="token operator">-</span>version<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   eval<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   filter<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   generate<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   git<span class="token operator">-</span>user<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   local<span class="token operator">-</span>path<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   logger<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   options<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   warnings<span class="token punctuation">.</span>js
└───test
<span class="token operator">|</span>   <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><h2 id="实现过程"><a href="#实现过程" aria-hidden="true" class="header-anchor">#</a> 实现过程</h2> <ol><li>控制台敲入初始化项目命令后，由 <code>pakcage.json</code> 内注册的命令可知，是执行了 <code>bin/vue</code> 文件内程序；</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>vue init webpack demo
</code></pre></div><ol start="2"><li><code>bin/vue</code> 是第三方模块 <code>commander</code> 的 show time ，node.js命令行界面的完整解决方案。方便实现自定义命令、用户输入收集。</li></ol> <ul><li><a href="https://github.com/tj/commander.js" target="_blank" rel="noopener noreferrer">commander官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <ol start="3"><li>由输入命令可知，走的是init命令。即 执行 <code>bin/vue-int</code>内的程序。其中涉及核心第三方模块如下：</li></ol> <ul><li><p><code>download-git-repo</code> 从github上下载代码(<em>这个插件还可以从gitlab、网络请求的方式下载等等</em>)</p></li> <li><p><code>ora</code> 显示spinner，命令行里的loading</p></li> <li><p><code>inquirer</code> 处理命令行交互</p></li> <li><p><code>chalk</code> 给枯燥的终端界面添加一些色彩</p></li></ul> <ol start="4"><li>模板渲染<code>lib/generate.js</code>，涉及核心第三方模块如下：</li></ol> <ul><li><a href="https://handlebarsjs.com/" target="_blank" rel="noopener noreferrer">handlebars<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模板引擎，无逻辑、预加载。下面demo熟悉下handerlars的语法特点，即一对{{}}，可自定义命令，如下面的 <code>if_eq</code> 命令。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width,initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./lib/handlebars-v4.1.2.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token comment">// &lt;script id=&quot;entry-template&quot; type=&quot;text/x-handlebars-template&quot;&gt;</span>
    <span class="token comment">//     &lt;div class=&quot;entry&quot;&gt;</span>
    <span class="token comment">//       &lt;h1&gt;{{title}}&lt;/h1&gt;</span>
    <span class="token comment">//       &lt;div class=&quot;body&quot;&gt;</span>
    <span class="token comment">//         {{body}}</span>
    <span class="token comment">//       &lt;/div&gt;</span>
    <span class="token comment">//     &lt;/div&gt;</span>
    <span class="token comment">// &lt;/script&gt;</span>
    <span class="token comment">// &lt;script type=&quot;text/javascript&quot;&gt;</span>
    <span class="token comment">//     //获取模板</span>
    <span class="token comment">//     var source = document.getElementById(&quot;entry-template&quot;).innerHTML;</span>
    <span class="token comment">//     //预编译模板</span>
    <span class="token comment">//     var template = Handlebars.compile(source);</span>
    <span class="token comment">//     //模拟json数据</span>
    <span class="token comment">//     var context = {title: &quot;My New Post&quot;, body: &quot;This is my first post!&quot;};</span>
    <span class="token comment">//     //匹配json内容</span>
    <span class="token comment">//     var html = template(context);</span>
    <span class="token comment">//     //输入模板</span>
    <span class="token comment">//     document.getElementById(&quot;app&quot;).innerHTML = html;</span>
    <span class="token comment">// &lt;/script&gt;</span>

    <span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;entry-template&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;text/x-handlebars-template&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>By <span class="token punctuation">{</span><span class="token punctuation">{</span>fullName author<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;body&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>body<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>            
            <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Comments<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>            
            <span class="token punctuation">{</span><span class="token punctuation">{</span>#each comments<span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span>#<span class="token keyword">if</span> author<span class="token punctuation">.</span>firstName <span class="token operator">==</span> <span class="token string">&quot;Yehuda&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>h2 style<span class="token operator">=</span><span class="token string">&quot;color:red;&quot;</span><span class="token operator">&gt;</span>By <span class="token punctuation">{</span><span class="token punctuation">{</span>fullName author<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">else</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>By <span class="token punctuation">{</span><span class="token punctuation">{</span>fullName author<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">}</span><span class="token punctuation">}</span>            
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;body&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>body<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token operator">/</span>each<span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>

        Handlebars<span class="token punctuation">.</span><span class="token function">registerHelper</span><span class="token punctuation">(</span><span class="token string">'fullName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Handlebars<span class="token punctuation">.</span><span class="token function">registerHelper</span><span class="token punctuation">(</span><span class="token string">'if_eq'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p1 <span class="token operator">==</span> p2<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> options<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> options<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取模板</span>
        <span class="token keyword">var</span> source <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;entry-template&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
        <span class="token comment">//预编译模板</span>
        <span class="token keyword">var</span> template <span class="token operator">=</span> Handlebars<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//模拟json数据</span>
        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
            author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                firstName<span class="token punctuation">:</span> <span class="token string">&quot;Alan&quot;</span><span class="token punctuation">,</span>
                lastName<span class="token punctuation">:</span> <span class="token string">&quot;Johnson&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token string">&quot;I Love Handlebars&quot;</span><span class="token punctuation">,</span>
            comments<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    firstName<span class="token punctuation">:</span> <span class="token string">&quot;Yehuda&quot;</span><span class="token punctuation">,</span>
                    lastName<span class="token punctuation">:</span> <span class="token string">&quot;Katz&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                body<span class="token punctuation">:</span> <span class="token string">&quot;Me too!&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    firstName<span class="token punctuation">:</span> <span class="token string">&quot;Yehuda22222&quot;</span><span class="token punctuation">,</span>
                    lastName<span class="token punctuation">:</span> <span class="token string">&quot;Katz2222&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                body<span class="token punctuation">:</span> <span class="token string">&quot;Me too!2222&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//匹配json内容</span>
        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输入模板</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><ul><li><a href="https://github.com/tj/consolidate.js" target="_blank" rel="noopener noreferrer">consolidate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模板引擎整合库。由于上面handlerbars模板引擎的用法繁琐，下面demo是handlerbars模板的适配器应用。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> cons <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consolidate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// cons.handlebars('你好好啊{{user}}', { user: 'tobi' }, function(err, html){</span>
<span class="token comment">//   if (err) throw err;</span>
<span class="token comment">//   console.log(html);</span>
<span class="token comment">// });</span>

<span class="token keyword">var</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./views/page.md'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cons<span class="token punctuation">.</span>handlebars<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">'tobi'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><a href="https://metalsmith.io/" target="_blank" rel="noopener noreferrer">metalsmith<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 静态网站生成器，用在批量处理模板的场景。最大的特点是 <code>everything is plugin</code></p></li> <li><p>这个工具有点像抽水机，不信请看下面的demo。</p></li></ul> <p><img src="/assets/img/metalsmith.cd49b2b6.jpg" alt></p> <ul><li>下面是 <code>metalsmith</code> 的官方demo，可以看到有源头有目的地，不是抽水机是神马。抽水的过程中可以利用插件来改造水的状态，比如说这里的是污水，那么要把污水净化一下，就需要在管中间开个小口，把水引到插件里去净化，净化完了再引回到抽水机中去继续往前流。当然这里的水是指拷贝的文件。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Metalsmith  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'metalsmith'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdown    <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'metalsmith-markdown'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> layouts     <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'metalsmith-layouts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> permalinks  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'metalsmith-permalinks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Metalsmith</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">&quot;My Static Site &amp; Blog&quot;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&quot;It's about saying »Hello« to the World.&quot;</span><span class="token punctuation">,</span>
  generator<span class="token punctuation">:</span> <span class="token string">&quot;Metalsmith&quot;</span><span class="token punctuation">,</span>
  url<span class="token punctuation">:</span> <span class="token string">&quot;http://www.metalsmith.io/&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token string">'./src'</span><span class="token punctuation">)</span>  <span class="token comment">//水源</span>
<span class="token punctuation">.</span><span class="token function">destination</span><span class="token punctuation">(</span><span class="token string">'./build'</span><span class="token punctuation">)</span>  <span class="token comment">//目的地</span>
<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//插件</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">permalinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//插件</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">layouts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  engine<span class="token punctuation">:</span> <span class="token string">'handlebars'</span>   <span class="token comment">//插件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 开关</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>小结：</strong></p> <ul><li><p><strong>控制台收集用户的输入（如初始化命令）</strong></p></li> <li><p><strong>命令行界面的提示信息 <code>chalk</code> 输出</strong></p></li> <li><p><strong>生成的脚手架如果已经存在 <code>inquirer</code> 询问用户是否继续</strong></p></li> <li><p><strong>根据用户的指令，使用 <code>down-git-repo</code> 从 <code>https://github.com/vuejs-templates</code> 下载 <code>webpack</code> 模板，下载过程中使用 <code>ora</code> 起到loading效果</strong></p></li> <li><p><strong>从下载好的模板中获取模板配置(<code>meta.js</code>)，比如问答内容（项目名称、项目描述....）、过虑文件、handlerbars自定义命令等</strong></p></li> <li><p><strong>根据配置 <code>helpers</code> 注册handlerbars的自定义命令</strong></p></li> <li><p><strong>根据配置的 <code>prompts</code> (问答内容) 利用 <code>inquirer</code> 模块收集用户需求</strong></p></li> <li><p><strong>命令行交互完毕的最后一刻通过 <code>metalsmith</code> 抽水机，把“水”（下载的模板）抽到目标文件夹。</strong></p></li> <li><p><strong>在“水流”中根据配置的 <code>filters</code>过虑文件</strong></p></li> <li><p><strong>在“水流”中利用 <code>consolidate</code> <code>handlerbars</code> 把模板渲染，模板渲染完毕后执行配置里的方法 <code>complete</code></strong></p></li> <li><p><strong>最后生成脚手架。</strong></p></li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <ul><li><p><strong>脚手架工具与模板分离，需要频繁变更的模板放到git上，低耦合，值得借鉴</strong></p></li> <li><p><strong>脚手架工具内置勾子，配置从模板里获取，灵活可扩展</strong></p></li> <li><p><strong>第三方模块的应用，思路清淅</strong></p></li> <li><p><strong>最后一张图诠释一切！</strong></p></li></ul> <p><img src="/assets/img/vueclitemplate-02.cc31705f.png" alt></p></div></div></div></div></div></div>
    <script src="/assets/js/app.22d2f077.js" defer></script><script src="/assets/js/3.8ed3c424.js" defer></script>
  </body>
</html>
