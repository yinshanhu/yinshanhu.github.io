<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-resource | 独上青楼</title>
    <meta name="description" content="昨夜西风凋碧树，独上青楼，望尽天涯路。">
    <script src="https://hm.baidu.com/hm.js?d341a53286439929323f4c9bccd9e597"></script>
  <script src="https://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
  <script src="snow.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.65ba1f90.css" as="style"><link rel="preload" href="/assets/js/app.5d459635.js" as="script"><link rel="preload" href="/assets/js/2.0bbd9e1c.js" as="script"><link rel="prefetch" href="/assets/js/10.621b5fae.js"><link rel="prefetch" href="/assets/js/11.d5f36a0f.js"><link rel="prefetch" href="/assets/js/12.8062cd1a.js"><link rel="prefetch" href="/assets/js/13.87d109b8.js"><link rel="prefetch" href="/assets/js/14.8fdc1f86.js"><link rel="prefetch" href="/assets/js/15.0ba925d2.js"><link rel="prefetch" href="/assets/js/16.77bf4c12.js"><link rel="prefetch" href="/assets/js/17.0210bf90.js"><link rel="prefetch" href="/assets/js/18.70bb2397.js"><link rel="prefetch" href="/assets/js/3.60a94497.js"><link rel="prefetch" href="/assets/js/4.62749a62.js"><link rel="prefetch" href="/assets/js/5.5800796f.js"><link rel="prefetch" href="/assets/js/6.90bea2c4.js"><link rel="prefetch" href="/assets/js/7.dc35a6a8.js"><link rel="prefetch" href="/assets/js/8.c206e4fb.js"><link rel="prefetch" href="/assets/js/9.3bba4c4c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65ba1f90.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="page-main"><div class="component-nav-menu"><div class="placeholder"></div> <div class="search-wrapper"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-6717" class="el-autocomplete"><div class="el-input el-input--prefix"><!----><input type="text" autocomplete="off" valueKey="title" placeholder="请输入内容" fetchSuggestions="function () { [native code] }" triggerOnFocus="true" debounce="300" placement="bottom-start" popperAppendToBody="true" background-color="#eee" value="" class="el-input__inner"><span class="el-input__prefix"><i class="el-input__icon el-icon-search"></i></span><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <ul role="menubar" class="el-menu--horizontal el-menu" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        首页
      </li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:;border-bottom-color:;background-color:;">
        Blog
      </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        关于我
      </li></ul></div> <div class="page-container"><div class="component-page"><div class="page-content"><!----> <div class="content custom"><h1 id="vue-resource"><a href="#vue-resource" aria-hidden="true" class="header-anchor">#</a> vue-resource</h1> <blockquote><p>2019.6.14</p></blockquote> <blockquote><p>想封装个网络请求模块，不知如何下手，所以找来vue官方出品的 vue-resource 插件，扒光了一看究竟，代码有值得学习的地方，也有我不认可的地方（且看文章吧）。</p></blockquote> <h2 id="大纲"><a href="#大纲" aria-hidden="true" class="header-anchor">#</a> 大纲</h2> <ul><li><p>一、什么是 VueResource</p></li> <li><p>二、简单使用（get请求 和 拦截器）</p></li> <li><p>三、结合简单使用方式讲解源码</p></li> <li><p>四、最后</p></li></ul> <h2 id="是什么"><a href="#是什么" aria-hidden="true" class="header-anchor">#</a> 是什么</h2> <p>vue-resource是Vue.js的一款插件，它可以通过XMLHttpRequest或JSONP发起请求并处理响应。也就是说，$.ajax能做的事情，vue-resource插件一样也能做到，而且vue-resource的API更为简洁。</p> <h3 id="特点："><a href="#特点：" aria-hidden="true" class="header-anchor">#</a> 特点：</h3> <ol><li>体积小</li></ol> <p>vue-resource非常小巧，在压缩以后只有大约12KB，服务端启用gzip压缩后只有4.5KB大小，这远比jQuery的体积要小得多。</p> <ol start="2"><li>支持主流的浏览器</li></ol> <p>和Vue.js一样，vue-resource除了不支持IE 9以下的浏览器，其他主流的浏览器都支持。</p> <ol start="3"><li>支持Promise API和URI Templates</li></ol> <p>Promise是ES6的特性，Promise的中文含义为“先知”，Promise对象用于异步计算。
URI Templates表示URI模板，有些类似于ASP.NET MVC的路由模板。</p> <ol start="4"><li>支持拦截器</li></ol> <p>拦截器是全局的，拦截器可以在请求发送前和发送请求后做一些处理。
拦截器在一些场景下会非常有用，比如请求发送前在headers中设置access_token，或者在请求失败时，提供共通的处理方式。</p> <h2 id="简单使用"><a href="#简单使用" aria-hidden="true" class="header-anchor">#</a> 简单使用</h2> <ol><li>在 vue-cli 中使用:</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//安装模块包</span>
npm install vue<span class="token operator">-</span>resource <span class="token operator">--</span>save
 
<span class="token comment">//然后在main.js（入口文件）中引入并注册</span>
<span class="token keyword">import</span> VueResource <span class="token keyword">from</span> <span class="token string">'vue-resource'</span> 
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>语法 &amp; API</li></ol> <ul><li>两种调用方式：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 基于全局Vue对象使用http</span>
Vue<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/someUrl'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/someUrl'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在一个Vue实例内使用$http</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/someUrl'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/someUrl'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>vue-resource 提供了 7 种请求 API(REST 风格)：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">head</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="get请求"><a href="#get请求" aria-hidden="true" class="header-anchor">#</a> get请求</h3> <img src="/assets/img/vue-resource-options.433139a8.png" style="width:100%;height:auto;"> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://way.jd.com/he/freeweather?city=suzhou&amp;appkey=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="/assets/img/vue-resource-process.c04c133e.png" style="width:100%;height:auto;"> <h3 id="拦截器"><a href="#拦截器" aria-hidden="true" class="header-anchor">#</a> 拦截器</h3> <img src="/assets/img/vue-resouce-inteceptor.5bd158ca.png" style="width:100%;height:auto;"> <h4 id="应用场景"><a href="#应用场景" aria-hidden="true" class="header-anchor">#</a> 应用场景</h4> <ul><li><p>请求前的loading</p></li> <li><p>请求前的token有效期校验</p></li> <li><p>请求前附加固定参数、设置headers</p></li> <li><p>统一处理接口异常跳转等</p></li></ul> <h3 id="结合使用方式讲解源码"><a href="#结合使用方式讲解源码" aria-hidden="true" class="header-anchor">#</a> 结合使用方式讲解源码</h3> <ul><li>package.json 文件修改引用路径方便调试</li></ul> <blockquote><p>node_module/vue-resource/package.json</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;dist/vue-resource.common.js&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;module&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;src/index.js&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p><em>module 节点原本是指向打包后的js文件，此处将其指向了源码。</em></p> <p><strong>main 和 module 两个节点都是用于指定加载路径。两者区别在于：main 节点是使用CommonJS的语法规范加载，module 是使用es6的语法规范加载。 ES6 中的 import 和 export 都是静态的。静态意味着一个模块要暴露或引入的所有方法在编译阶段就全部确定了，之后不能再改变。这样做的好处就是打包工具在打包阶段就可以分析出代码中用到了某个模块中的哪几个方法。其它没有用到的方法就可以从最终的 bundle 文件中剔除掉。这样既可以减少 bundle 文件的大小，又可以提高脚本的执行速度。这个机制就叫做 Tree Shaking。当打包工具遇到我们的模块时：①如果它已经支持 module 字段则会优先使用 ES6 模块规范的版本，这样可以启用 Tree Shaking 机制。②如果它还不识别 module 字段则会使用我们已经编译成 CommonJS 规范的版本，也不会阻碍打包流程。</strong></p> <ul><li>源码结构</li></ul> <img src="/assets/img/vue-resource-code.43ee9c1e.png" style="width:100%;height:auto;"> <ul><li>直接上图了，源码有点影响视觉，就不上源码了。（<strong>下面是我花了两个小时精心修饰的执行原理图</strong>）</li></ul> <img src="/assets/img/v-resource-zhan.1f30c008.png" style="width:100%;height:auto;"> <p><strong>在此吐槽一下我不认可的地方：在从执行栈依次取出注册方法执行的过程中，分捡操作是按注册方法执行后响应的结果类型（http/client/index.js里isObject、isFunction两处逻辑）来区分是做响应拦截的还是做请求拦截的。此处个人感觉这种方式不妥，如果能在注册的时候就用两个栈（或者数组）分别存储请求前拦截和响应后拦截的注册方法，也许作者就不用写这样冗余的代码了，个人的一点愚见，欢迎指正。</strong></p> <h3 id="resource"><a href="#resource" aria-hidden="true" class="header-anchor">#</a> Resource</h3> <ul><li>使用方式</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> resouce <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$resource</span><span class="token punctuation">(</span><span class="token string">'https://way.jd.com/he/freeweather?city=suzhou&amp;appkey='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

resouce<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span> response <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>从源码看出，本质上还是调取的 Http</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resource<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>$http <span class="token operator">||</span> Http<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">opts</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="最后"><a href="#最后" aria-hidden="true" class="header-anchor">#</a> 最后</h3> <h4 id="vue-resource是一个非常轻量的用于处理http请求的插件，它提供了两种方式来处理http请求："><a href="#vue-resource是一个非常轻量的用于处理http请求的插件，它提供了两种方式来处理http请求：" aria-hidden="true" class="header-anchor">#</a> vue-resource是一个非常轻量的用于处理HTTP请求的插件，它提供了两种方式来处理HTTP请求：</h4> <ul><li>使用Vue.http或this.$http</li> <li>使用Vue.resource或this.$resource</li> <li>这两种方式本质上没有什么区别，阅读vue-resource的源码，你可以发现第2种方式是基于第1种方式实现的。</li></ul> <h4 id="inteceptor可以在请求前和请求后附加一些行为，这意味着除了请求处理的过程，请求的其他环节都可以由我们来控制。"><a href="#inteceptor可以在请求前和请求后附加一些行为，这意味着除了请求处理的过程，请求的其他环节都可以由我们来控制。" aria-hidden="true" class="header-anchor">#</a> inteceptor可以在请求前和请求后附加一些行为，这意味着除了请求处理的过程，请求的其他环节都可以由我们来控制。</h4> <h4 id="vue更新到2-0之后-作者就宣告不再对vue-resource更新-而是推荐的axios。"><a href="#vue更新到2-0之后-作者就宣告不再对vue-resource更新-而是推荐的axios。" aria-hidden="true" class="header-anchor">#</a> vue更新到2.0之后,作者就宣告不再对vue-resource更新,而是推荐的axios。</h4> <img src="/assets/img/vue-resource-vrgithub.cf219b68.png" style="width:100%;height:auto;"> <img src="/assets/img/vue-resource-axios.691a6372.png" style="width:100%;height:auto;margin-top:60px;"></div></div></div></div></div></div>
    <script src="/assets/js/app.5d459635.js" defer></script><script src="/assets/js/2.0bbd9e1c.js" defer></script>
  </body>
</html>
